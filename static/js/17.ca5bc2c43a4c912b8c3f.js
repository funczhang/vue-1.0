webpackJsonp([17],{115:function(s,a,t){var n=t(20)(null,t(143),null,null);s.exports=n.exports},143:function(s,a){s.exports={render:function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("h2",[s._v("异步请求")]),s._v(" "),t("h3",[s._v("问题")]),s._v(" "),t("blockquote",[t("p",[s._v("项目中前端与服务端进行数据交互是必不可少的，下面针对vue与服务端交互，在不同情况下，提供几种解决方案。")])]),s._v(" "),t("br"),s._v(" "),t("h3",[s._v("1.APP中与原生进行数据交互")]),s._v(" "),t("p",[s._v("  Vue在与原生APP进行数据交互时，需要依赖与原生制定的一套相关约定协议，已类似于调接口的方式，将数据发送给原生，由原生请求服务器，再将返回数据返还给Vue，从而实现Vue与服务端数据交互。")]),s._v(" "),s._m(0),s._v(" "),t("h4",[s._v("action")]),s._v(" "),s._m(1),s._v(" "),t("p",[s._v("  这里的action方法返回一个Promise对象，需要注意的是，必须且只能返回Promise对象，相关的原因后面会有详细解释。")]),s._v(" "),t("br"),s._v(" "),t("h4",[s._v("example.vue")]),s._v(" "),s._m(2),s._v(" "),t("p",[s._v("  这里是调用action内的方法，需要注意的是，这里使用到了async同步函数，await表示只有当这一行的方法执行结束，并且返回数据时，再执行后面的代码。作为ES7的新特性，可以在不占用大量资源的同时，让浏览器产生阻塞，从而实现js代码的同步执行。")]),s._v(" "),s._m(3),s._v(" "),t("br"),s._v(" "),t("h4",[s._v("相关源码")]),s._v(" "),s._m(4),s._v(" "),t("br"),s._v(" "),t("h3",[s._v("2.直接与服务器数据交互")]),s._v(" "),s._m(5),s._v(" "),t("p",[s._v("  具体的代码可以参考以下详细代码。")]),s._v(" "),t("h4",[s._v("main.js")]),s._v(" "),s._m(6),s._v(" "),t("p",[s._v("  在vue的最外层组件main.js，将axios框架引入，并将axios对象注入到vue原型方法上，使其在vue的内部组件内可以被调用。")]),s._v(" "),t("br"),s._v(" "),t("h4",[s._v("action")]),s._v(" "),s._m(7),s._v(" "),t("p",[s._v("  这里的代码是action内所定义的方法，组件中通过dispatch调用getUser方法，调用axios进行异步请求，当数据返回后，进行后续的数据处理，如果接口异常，将会抛出异常。")]),s._v(" "),t("br"),s._v(" "),t("h4",[s._v("example.vue")]),s._v(" "),s._m(8),s._v(" "),t("p",[s._v("  页面调用action，在then方法中继续编写后续业务逻辑代码。")]),s._v(" "),t("br"),s._v(" "),t("h4",[s._v("相关源码")]),s._v(" "),s._m(9)],1)},staticRenderFns:[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("p",[s._v("  这里以科大讯飞的 "),t("code",[s._v("FlyJs")]),s._v(" 中的原生交互模块为例，展示具体的数据交互过程。")])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("pre",[t("code",{staticClass:"language-javascript"},[s._v("\n"),t("span",{staticClass:"hljs-comment"},[s._v("//index.js")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" apiRequest = "),t("span",{staticClass:"hljs-function"},[s._v("("),t("span",{staticClass:"hljs-params"},[s._v("context, data")]),s._v(") =>")]),s._v(" {\n    "),t("span",{staticClass:"hljs-comment"},[s._v("//返回Promise对象（ES6语法）")]),s._v("\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" "),t("span",{staticClass:"hljs-built_in"},[s._v("Promise")]),s._v("("),t("span",{staticClass:"hljs-function"},[s._v("("),t("span",{staticClass:"hljs-params"},[s._v("resolve, reject")]),s._v(") =>")]),s._v(" {\n        "),t("span",{staticClass:"hljs-comment"},[s._v("//flyJs与原生交互接口定义")]),s._v("\n        fly.request({\n                "),t("span",{staticClass:"hljs-attr"},[s._v("action")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v("'BaseComponents.data'")]),s._v(",\n                "),t("span",{staticClass:"hljs-attr"},[s._v("callback")]),s._v(": data.method.toString() + "),t("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v(".parse("),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" "),t("span",{staticClass:"hljs-built_in"},[s._v("Date")]),s._v("()),\n                "),t("span",{staticClass:"hljs-attr"},[s._v("args")]),s._v(": ["),t("span",{staticClass:"hljs-string"},[s._v("'api_request'")]),s._v(", data.data, data.method]\n            })\n            .done("),t("span",{staticClass:"hljs-function"},[s._v("("),t("span",{staticClass:"hljs-params"},[s._v("flag, response")]),s._v(") =>")]),s._v(" {\n                "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (flag == "),t("span",{staticClass:"hljs-string"},[s._v("'1'")]),s._v(") {\n                    resolve(response)\n                } "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (flag == "),t("span",{staticClass:"hljs-string"},[s._v("'0'")]),s._v(") {\n                    toast(context, response)\n                }\n            })\n        })\n    })\n}\n\n")])])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("pre",[t("code",{staticClass:"language-html"},[s._v("\n"),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-name"},[s._v("script")]),s._v(" "),t("span",{staticClass:"hljs-attr"},[s._v("lang")]),s._v("="),t("span",{staticClass:"hljs-string"},[s._v('"text/babel"')]),s._v(">")]),t("span",{staticClass:"javascript"},[s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("name")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v("'example'")]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("components")]),s._v(": {\n    },\n    "),t("span",{staticClass:"hljs-attr"},[s._v("methods")]),s._v(":{\n        "),t("span",{staticClass:"hljs-comment"},[s._v("//调用action中的方法")]),s._v("\n        "),t("span",{staticClass:"hljs-keyword"},[s._v("async")]),s._v(" getUser() {\n            "),t("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" res = "),t("span",{staticClass:"hljs-keyword"},[s._v("await")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$store.dispatch("),t("span",{staticClass:"hljs-string"},[s._v("'getUser'")]),s._v(")\n            "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log(res);\n        }\n    }\n}\n")]),t("span",{staticClass:"hljs-tag"},[s._v("</"),t("span",{staticClass:"hljs-name"},[s._v("script")]),s._v(">")]),s._v("\n\n")])])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("p",[t("strong",[s._v("使用本规范的研发人员，请注意务必尽量使用async同步函数实现接口数据的获取。")])])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ul",[t("li",[s._v("FlyJs: 具体源码因涉及到技术保密，不予公开。")])])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("p",[s._v("  对于一般web项目，直接与服务端进行数据交互时，需要使用vue官方推荐的接口请求框架，例如axios、"),t("a",{attrs:{href:"https://github.com/pagekit/vue-resource"}},[s._v("vue-resource")]),s._v(" (vue2x版本已不建议使用) 等，这里以axios为例。axios为第三方数据交互框架，vue使用axios需要使用nodeJs安装其针对vue开发的npm包，安装之后在vue的最外层实例化组件中引入，再将接口封装到vuex的action中，以供需要的时候调用。")])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("pre",[t("code",{staticClass:"language-javascript"},[s._v("\n"),t("span",{staticClass:"hljs-comment"},[s._v("//main.js")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" Vue "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'vue'")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" App "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'./App'")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" Vuex "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'vuex'")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" store "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'./store/index.js'")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" router "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'./router'")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" axios "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'axios'")]),s._v("\n\n\n"),t("span",{staticClass:"hljs-comment"},[s._v("//使用axios作为http请求方式")]),s._v("\nVue.prototype.$http = axios\n\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" app = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" Vue({\n  store,\n  router,\n  "),t("span",{staticClass:"hljs-attr"},[s._v("render")]),s._v(": "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-params"},[s._v("h")]),s._v(" =>")]),s._v(" h(App)\n}).$mount("),t("span",{staticClass:"hljs-string"},[s._v("'#app'")]),s._v(")\n\n")])])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("pre",[t("code",{staticClass:"language-javascript"},[s._v("\n"),t("span",{staticClass:"hljs-comment"},[s._v("//index.js")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" getUser = "),t("span",{staticClass:"hljs-function"},[s._v("("),t("span",{staticClass:"hljs-params"},[s._v("context, payload")]),s._v(") =>")]),s._v(" {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" host = "),t("span",{staticClass:"hljs-string"},[s._v("'http://172.0.0.1/getUser'")]),s._v("\n    payload.vue.$http.post(host, payload.data)\n        .then("),t("span",{staticClass:"hljs-function"},[s._v("("),t("span",{staticClass:"hljs-params"},[s._v("response")]),s._v(") =>")]),s._v(" {\n            resolve(response.data)"),t("span",{staticClass:"hljs-comment"},[s._v("//成功返回，处理数据")]),s._v("\n        })\n        .catch("),t("span",{staticClass:"hljs-function"},[s._v("("),t("span",{staticClass:"hljs-params"},[s._v("response")]),s._v(") =>")]),s._v(" {\n            "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v("'axios:error:['")]),s._v(" + output(response.status) + "),t("span",{staticClass:"hljs-string"},[s._v("']'")]),s._v(" + output(response.data));"),t("span",{staticClass:"hljs-comment"},[s._v("//抛出异常")]),s._v("\n        })\n}\n\n")])])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("pre",[t("code",{staticClass:"language-html"},[s._v("\n"),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-name"},[s._v("script")]),s._v(" "),t("span",{staticClass:"hljs-attr"},[s._v("lang")]),s._v("="),t("span",{staticClass:"hljs-string"},[s._v('"text/babel"')]),s._v(">")]),t("span",{staticClass:"javascript"},[s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n    "),t("span",{staticClass:"hljs-attr"},[s._v("name")]),s._v(": "),t("span",{staticClass:"hljs-string"},[s._v("'example'")]),s._v(",\n    "),t("span",{staticClass:"hljs-attr"},[s._v("components")]),s._v(": {\n    },\n    "),t("span",{staticClass:"hljs-attr"},[s._v("methods")]),s._v(":{\n        "),t("span",{staticClass:"hljs-comment"},[s._v("//调用action中的方法")]),s._v("\n        getUser() {\n            "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$store.dispatch("),t("span",{staticClass:"hljs-string"},[s._v("'getUser'")]),s._v(",{"),t("span",{staticClass:"hljs-attr"},[s._v("data")]),s._v(":{},"),t("span",{staticClass:"hljs-attr"},[s._v("vue")]),s._v(":"),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("}).then("),t("span",{staticClass:"hljs-function"},[s._v("("),t("span",{staticClass:"hljs-params"},[s._v("res")]),s._v(")=>")]),s._v("{\n                "),t("span",{staticClass:"hljs-comment"},[s._v("//获取接口返回的数据")]),s._v("\n                "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-built_in"},[s._v("JSON")]),s._v(".stringift(res));\n            })\n        }\n    }\n}\n")]),t("span",{staticClass:"hljs-tag"},[s._v("</"),t("span",{staticClass:"hljs-name"},[s._v("script")]),s._v(">")]),s._v("\n\n\n")])])},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ul",[t("li",[s._v("axios: "),t("a",{attrs:{href:"https://github.com/mzabriskie/axios"}},[s._v("https://github.com/mzabriskie/axios")])])])}]}},68:function(s,a,t){s.exports=t(115)}});